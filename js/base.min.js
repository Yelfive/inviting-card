+function(){function f(a,b,c){return a.addEventListener(b,c,!1)}function G(){r.querySelector(".container").removeChild(document.querySelector(".loading"));t(document.getElementById("votes"));H();m.init()}function u(){}function t(a){if(a instanceof HTMLElement){var b=a.innerHTML.replace(/ {2,}/g," ");a.innerHTML="";var c=a.style.opacity=1,d=arguments,e=this,g=setInterval(function(){"<"==b.substr(c,1)?c=b.indexOf(">",c)+1:c++;a.innerHTML=b.substring(0,c)+(c&1&&c<b.length?"_":"");c>=b.length&&(clearInterval(g),g=null,d[1]instanceof Function&&d[1].call(v,a),e instanceof u&&q.queue.length&&q.start())},75)}}function A(){switch(TERMINAL){case"pc":this.album=document.querySelector("#album-ul");if(!this.album)break;this.lis=this.album.querySelectorAll("li");this.imgCount=this.lis.length;this.timeout=1E3}}function B(){this.music=document.querySelector("#music");this.audio=this.music.querySelector("audio");var a=this;f(this.music,"touchstart",function(){a._paused()?a.play():a.pause()});this._paused()||this.play();document.ontouchstart=function(){a._paused()||a.play();this.ontouchstart=void 0};var b=function(){a._paused()||a.play();document.removeEventListener("touchstart",b)};document.addEventListener("touchstart",b)}if(void 0!==window.orientation&&0!==window.orientation)return alert("\u7ad6\u5c4f\u6548\u679c\u66f4\u597d\u54df~");var h=document.querySelector("#love-movie video"),I=document.querySelector("#timing-being-together"),w={wechat:"undefined"===typeof wx?null:wx,init:function(){if(this.wechat){var a=["onMenuShareAppMessage","onMenuShareTimeline","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"];DATA.config.jsApiList=["previewImage","openLocation"];for(var b=0,c=a.length;b<c;b++)DATA.config.jsApiList.push(a[b]);this.wechat.config(DATA.config);var d=this;this.wechat.ready(function(){DATA.shareConfig.fail=function(){console.log(arguments)};for(var b=0,c=a.length;b<c;b++)d.wechat[a[b]](DATA.shareConfig)})}},previewImage:function(a){var b={current:DATA.images[0],urls:DATA.images};a&&(b.complete=a);this.wechat.previewImage(b)},openLocation:function(a){var b={fail:function(a){alert(a.errMsg)},latitude:30.6001688195,longitude:103.914336072,name:"\u53cc\u6d41\u805a\u7af9\u56ed\u9152\u697c",address:"\u53cc\u6d41\u53bf\u5176\u4ed6\u822a\u7a7a\u8def\u897f\u6bb52\u53f7\u8fd1\u7d2b\u8346\u7535\u5f71\u9662,\u805a\u7af9\u56ed\u9152\u697c\u53cc\u6d41\u793a\u8303\u5e97 (028)85736222",scale:20,infoUrl:"abc"};a&&a instanceof Function&&(b.complete=a);this.wechat.openLocation(b)}};w.init();var r=document.body;window.onload=function(){document.querySelector(".loading").className="loading running";setTimeout(G,550);C.init()};var k=document.getElementById("circle-flowers"),n=k.clientWidth;k.style.height=n+"px";var D={config:{radius:0,zero:{x:0,y:0},total:0,randomPosition:!0},circle:function(a){if(0<this.config.total&&0<this.config.radius)return a=2*Math.PI*a/this.config.total,!0===this.config.randomPosition&&(a+=Math.random()*Math.PI/18),{x:this.config.zero.x+this.config.radius*Math.cos(a),y:this.config.zero.y+this.config.radius*Math.sin(a)};throw Error("Invalid config for coordinate.");}},x=k.nextElementSibling,H=function(){var a=k.children,b=a.length;k.className+=" bloom";x.style.top=n/2*.8+"px";radius=.4*n;D.config={radius:radius,zero:{x:n/2,y:n/2},total:b,randomPosition:!0};for(var c=0,d,e;c<=b;c++){d=a[c];if(!d)break;e=D.circle(c);d.style.left=e.x-d.clientWidth/2+"px";d.style.top=e.y-d.clientHeight/2+"px"}setTimeout(function(){t(x,function(){v[x.dataset.timingType]()})},2300)};u.prototype={queue:[],add:function(){this.queue.push(arguments)},start:function(){var a=this.queue.shift();t.call(this,a[0],a[1])}};var q=new u,J=r.clientWidth,y=document.querySelector(".wrapper"),p=function(){this.currentDom=document.querySelector(".wrapper>div");this.timeout=550;var a=this,b,c={x:0,y:0},d=.1*J;f(y,"touchstart",function(a){b=c={x:a.touches[0].clientX,y:a.touches[0].clientY}});f(y,"touchmove",function(a){b={x:a.touches[0].clientX,y:a.touches[0].clientY}});f(y,"touchend",function(){var e,g,f=parseInt((b.x-c.x)/d);0<f?(e=a.currentDom.previousElementSibling,g="backward"):0>f&&(e=a.currentDom.nextElementSibling,g="forward");e instanceof HTMLElement?a.flipTo(e,g):a.registerTremble(a.currentDom,f)})},E=document.querySelector("#wrapper-mask");p.prototype={hasClass:function(a,b){return(new RegExp("\\b"+b+"\\b")).test(a.className)},removeClass:function(a,b){a.className=a.className.replace(new RegExp("\\b"+b+"\\b"),"").replace(/ {2,}/," ");return this},addClass:function(a,b){if(!this.hasClass(a,b)){var c=a.className;a.className=(c?c+" "+b:b).replace(/ {2,}/," ");return this}},prev:function(){var a=this.currentDom.previousElementSibling;a&&this.flipTo(a)},next:function(){var a=this.currentDom.nextElementSibling;a&&this.flipTo(a)},arrowLeft:document.querySelector(".arrow.left"),arrowRight:document.querySelector(".arrow.right"),flipTo:function(a,b){if(a==this.currentDom)this.registerTremble(a,b);else{E.className="active";a.id="love-movie";h.className="hide";h.pause();var c,d;switch(b){case"forward":c="flip-0-m90";d="flip-90-0";break;default:c="flip-0-90",d="flip-m90-0"}var e=this,g=e.currentDom;e.addClass(g,c);setTimeout(function(){e.addClass(g,"rotateY-90").removeClass(g,c);e.addClass(a,d);setTimeout(function(){e.afterFlipped(a,b,d);F[a.dataset.init]instanceof Function&&(F[a.dataset.init](a),a.dataset.init=null)},e.timeout)},e.timeout);this.currentDom=a}},afterFlipped:function(a,b,c){this.removeClass(a,"rotateY-90").removeClass(a,c);E.className="";this.registerArrow(a);this.registerTremble(a,b)},registerTremble:function(a,b){var c=a.className;a.className=c+" tremble "+("backward"==b?"anti":"")+"clockwise";setTimeout(function(){a.className=c},500)},registerArrow:function(a){this.arrowRight.className=a.nextElementSibling?"arrow right":"arrow right disabled";this.arrowLeft.className=a.previousElementSibling?"arrow left":"arrow left disabled"}};var l=new p;A.prototype={downloadInterval:100,img:null,show:function(){switch(TERMINAL){case"pc":if(l.hasClass(this.album,"photo-in"))break;this.album.className+=" photo-in"}},init:function(){switch(TERMINAL){case"pc":return this._initPc();case"mobile":return this._initMobile()}return this},_initMobile:function(){f(document.querySelector(".wrapper .album .start"),"click",function(){z.show();w.previewImage(function(){z.hide()})})},_initPc:function(){function a(){c.img.src=DATA.photoHost+"/"+b+".jpg"}var b=17,c=this;this.img=new Image;this.img.onload=function(){c.lis[b-1].querySelector("img").src=DATA.photoHost+"/"+b+".jpg";0<--b?setTimeout(a,c.downloadInterval):(this.onload=null,c.img=null)};a();for(b=0;b<c.imgCount;b++)c.lis[b].index=b,f(c.lis[b],"click",function(){var a=this;a.className="photo-out";setTimeout(function(){a.className="hide"},c.timeout);0==this.index&&setTimeout(function(){l.removeClass(c.album,"photo-in");for(var a=0;a<c.imgCount;a++)c.lis[a].className="";c.show()},c.timeout)});return this}};var C=new A,v={diff:window.diff,zeroFill:function(a){return 10>a?"0"+a:a},together:function(){var a,b=this,c=I.querySelectorAll(".value"),d=c[0],e=c[1],g=c[2],f=c[3];this.register(function(){a=(new Date-b.diff)/1E3-1405785600;d.innerText=b._days(a);e.innerText=b._hour(a);g.innerText=b._minute(a);f.innerText=b._second(a)})},story:function(){var a,b=this,c=document.querySelector("#timing-love-story").querySelectorAll(".value"),d=c[0],e=c[1],g=c[2],f=c[3],h=c[4],k=c[5];this.register(function(){a=(new Date-b.diff)/1E3-1030809600;d.innerText=b._years(a);e.innerText=b._month(a);g.innerText=b._day(a);f.innerText=b._hour(a);h.innerText=b._minute(a);k.innerText=b._second(a)})},marriage:function(){var a,b=this,c=document.querySelector("#timing-to-marriage").querySelectorAll(".value"),d=c[0],e=c[1],g=c[2],f=c[3];this.register(function(){a=1458403200-(new Date-b.diff)/1E3;d.innerText=b._days(a);e.innerText=b._hour(a);g.innerText=b._minute(a);f.innerText=b._second(a)})},_years:function(a){return parseInt(a/86400/365)},_days:function(a){return this.zeroFill(parseInt(a/86400))},_month:function(a){return this.zeroFill(parseInt(a/86400%365/30))},_day:function(a){return this.zeroFill(parseInt(a/86400%365))},_hour:function(a){return this.zeroFill(parseInt(a/3600%24))},_minute:function(a){return this.zeroFill(parseInt(a/60%60))},_second:function(a){return this.zeroFill(parseInt(a%60))},register:function(a){a();setInterval(a,1E3)}};new function(){var a=r.clientWidth,b=document.querySelector("#love-movie .video");b.style.height=.75*a+"px";b.style.marginTop=.75*-a/2+"px"};p=function(){this.menu=document.querySelector("#menu");this.touch=this.menu.querySelector("#touch-us");this.items=this.menu.querySelector("#items");this.bubbleContainer=this.menu.querySelector("#bubble")};p.prototype={init:function(){this.bubble();this.registerJs()},registerJs:function(){for(var a=this.items.children,b=a.length,c=document.querySelector(".wrapper"),d=this,e=0;e<b;e++)f(a[e],"click",function(){var a=c.querySelector("."+this.dataset.class);a&&(l.flipTo(a),d.hide())})},hide:function(){var a=this;a.menu.className+=" fade";setTimeout(function(){a.menu.className="";a.touch.className="touch-in"},500)},show:function(){l.hasClass(this.menu,"kiss")||("love-movie"==l.currentDom.id&&(h.className="hide",h.pause()),this.touch.className="",this.menu.className="kiss")},bubble:function(){for(var a=0;10>a;a++)this.bubbleContainer.appendChild(new Heart(document.createElement("canvas")))}};var m=new p;f(m.touch,"touchstart",function(){l.hasClass(m.menu,"kiss")?m.hide():m.show()});var z={_:document.querySelector("#heartbeats"),init:function(){for(var a=0;3>a;a++)this._.appendChild(new Heart(document.createElement("canvas")))},show:function(){this._.className="beats";var a=this;setTimeout(function(){a.hide()},1E3)},hide:function(){this._.className=""}};z.init();B.prototype={init:function(){},_paused:function(){return 1==localStorage.musicPaused},play:function(){this.audio.play();this.music.className="";localStorage.musicPaused=0},pause:function(){this.music.className="paused";this.audio.pause();localStorage.musicPaused=1}};new B;var F={typeIn:function(a){for(var b,c=0,d=a.children[0].children,e=d.length;c<e;c++)a=(b=d[c].dataset.timingType)?v[b]:void 0,q.add(d[c],a);q.start()},albumShow:function(){C.show()},openMap:function(a){var b=new BMap.Map("map"),c=new BMap.Point(103.920752,30.606453);b.centerAndZoom(c,15);b.addOverlay(new BMap.Marker(c));var d=a.querySelector("#open-map");f(d,"click",function(){d.className="active";setTimeout(function(){d.className="";w.openLocation()},50)})},movie:function(a){a=a.querySelector(".start");f(a,"click",function(){h.play();h.className=""})}}}();