+function(){function F(){this.music=document.querySelector("#music");this.audio=this.music.querySelector("audio");var a=this;h(this.music,"touchstart",function(){a._paused()?a.play():a.pause()});this._paused()||this.play();var b=function(){a._paused()||a.play();document.removeEventListener("touchstart",b)};document.addEventListener("touchstart",b)}function G(){var a=n.clientWidth,b=document.querySelector("#love-movie .video");b.style.height=.75*a+"px";b.style.marginTop=.75*-a/2+"px"}function h(a,b,c){return a.addEventListener(b,c,!1)}function M(){p.querySelector(".container").removeChild(document.querySelector(".loading"));var a=document.getElementById("votes");p.style.width=l.width+"px";p.style.height=l.height+"px";N();u.init();H(a,function(){a.querySelector(".hotel").addEventListener("click",function(){k.flipTo(O,"forward")});x.marriage()})}function P(a){m.style.height=a+"px";a=n.querySelector(".welcome .words");a.style.marginTop=(v.height-m.offsetHeight-a.offsetHeight)/2+"px"}function B(){}function H(a){if(a instanceof HTMLElement){var b=a.innerHTML.replace(/ {2,}/g,"");a.innerHTML="";var c=a.style.opacity=1,d=arguments,e=this,g=setInterval(function(){var f=b.substr(c,1);"<"==f?c=b.indexOf(">",c)+1:"&"==f?c=b.indexOf(";",c)+1:c++;a.innerHTML=b.substring(0,c)+(c&1&&c<b.length?"_":"");c>=b.length&&(clearInterval(g),g=null,d[1]instanceof Function&&d[1].call(x,a),e instanceof B&&y.queue.length&&y.start())},75)}}function I(){switch(TERMINAL){case"pc":this.album=document.querySelector("#album-ul");if(!this.album)break;this.lis=this.album.querySelectorAll("li");this.imgCount=this.lis.length;this.timeout=1E3;break;case"mobile":this.album=document.querySelector("#album")}}if(void 0!==window.orientation&&0!==window.orientation)return alert("\u7ad6\u5c4f\u6548\u679c\u66f4\u597d\u54df~");document.ontouchmove=function(a){return a.preventDefault()};var p=document.body,l={width:p.clientWidth,height:p.clientHeight},Q=document.querySelector("#map").parentNode,n=document.querySelector(".wrapper"),q=document.querySelector("#love-movie video"),R=document.querySelector("#timing-being-together"),O=n.querySelector(".invitation"),r=document.querySelector("#touch-us"),m=document.getElementById("circle-flowers"),v={};(function(){var a=p.querySelector(".container");if(l.width>l.height){var b=a.offsetHeight;v={width:.625*b,height:b};a.style.height=v.height+"px";a.style.width=v.width+"px"}else v={height:a.offsetHeight,width:a.offsetWidth}})();F.prototype={init:function(){},_paused:function(){return 1==localStorage.musicPaused},play:function(){this.audio.play();this.music.className="";localStorage.musicPaused=0},pause:function(){this.music.className="paused";this.audio.pause();localStorage.musicPaused=1}};var C=new F;G.prototype={musicPaused:"",playCalled:!1,startButton:document.querySelector("#love-movie .start"),play:function(){this.startButton.className="hide";this.musicPaused=C._paused();q.className="";q.play();C.pause();this.playCalled=!0},pause:function(){this.startButton.className="start";q.className="hide";q.pause();this.playCalled&&(this.playCalled=!1,this.musicPaused||C.play())}};var z=new G,D={wechat:"undefined"===typeof wx?null:wx,init:function(){if(IS_WECHAT&&this.wechat){var a=["onMenuShareAppMessage","onMenuShareTimeline","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"];DATA.config.jsApiList=["previewImage","openLocation"];for(var b=0,c=a.length;b<c;b++)DATA.config.jsApiList.push(a[b]);this.wechat.config(DATA.config);var d=this;this.wechat.ready(function(){DATA.shareConfig.fail=function(){console.log(arguments)};for(var b=0,c=a.length;b<c;b++)d.wechat[a[b]](DATA.shareConfig)})}},previewImage:function(a){if(IS_WECHAT){var b={current:DATA.images[0],urls:DATA.images};a&&(b.complete=a);this.wechat.previewImage(b)}},openLocation:function(a){if(IS_WECHAT){var b={fail:function(a){alert(a.errMsg)},latitude:30.6001688195,longitude:103.914336072,name:"\u53cc\u6d41\u805a\u7af9\u56ed\u9152\u697c",address:"\u53cc\u6d41\u53bf\u5176\u4ed6\u822a\u7a7a\u8def\u897f\u6bb52\u53f7\u8fd1\u7d2b\u8346\u7535\u5f71\u9662,\u805a\u7af9\u56ed\u9152\u697c\u53cc\u6d41\u793a\u8303\u5e97 (028)85736222",scale:20,infoUrl:"abc"};a&&a instanceof Function&&(b.complete=a);this.wechat.openLocation(b)}}};IS_WECHAT&&D.init();window.onload=function(){document.querySelector(".loading").className="loading running";setTimeout(M,550);J.init()};var K={config:{radius:0,zero:{x:0,y:0},total:0,randomPosition:!0},circle:function(a){if(0<this.config.total&&0<this.config.radius)return a=2*Math.PI*a/this.config.total,!0===this.config.randomPosition&&(a+=Math.random()*Math.PI/18),{x:this.config.zero.x+this.config.radius*Math.cos(a),y:this.config.zero.y+this.config.radius*Math.sin(a)};throw Error("Invalid config for coordinate.");}},N=function(){var a=m.clientWidth,b=m.children,c=b.length;P(a);m.className+=" fade-in bloom";radius=.4*a;K.config={radius:radius,zero:{x:a/2,y:a/2},total:c,randomPosition:!0};for(var d=0,e,g;d<=c;d++){e=b[d];if(!e)break;g=K.circle(d);e.style.left=g.x-e.clientWidth/2+"px";e.style.top=g.y-e.clientHeight/2+"px"}var f=m.previousElementSibling;f.style.height=a+"px";setTimeout(function(){f.className+=" fade-in"},6300)};B.prototype={queue:[],add:function(){this.queue.push(arguments)},start:function(){var a=this.queue.shift();H.call(this,a[0],a[1])}};var y=new B,w=function(){this.currentDom=document.querySelector(".wrapper>div");this.timeout=550;var a=this,b,c={x:0,y:0},d=.1*l.width;h(n,"touchstart",function(a){b=c={x:a.touches[0].clientX,y:a.touches[0].clientY}});h(n,"touchmove",function(a){b={x:a.touches[0].clientX,y:a.touches[0].clientY};a.preventDefault()});var e=function(e){var f;if("click"==e.type)return k.hasClass(this,"right")?k.next():k.prev();if(!e.target||!Q.contains(e.target)){var t;e=parseInt((b.x-c.x)/d);0==e||Math.abs(b.x-c.x)<Math.abs(b.y-c.y)||(0<e?(t=a.currentDom.previousElementSibling,f="backward"):0>e&&(t=a.currentDom.nextElementSibling,f="forward"),t instanceof HTMLElement?a.flipTo(t,f):a.registerTremble(a.currentDom,f))}};h(n,"touchend",e);h(this.arrowLeft,"click",e);h(this.arrowRight,"click",e)},A={element:document.querySelector("#wrapper-mask"),show:function(){this.element.className="active"},hide:function(){this.element.className=""}};w.prototype={hasClass:function(a,b){return(new RegExp("\\b"+b+"\\b")).test(a.className)},removeClass:function(a,b){a.className=a.className.replace(new RegExp("\\b"+b+"\\b"),"").replace(/ {2,}/," ");return this},addClass:function(a,b){if(!this.hasClass(a,b)){var c=a.className;a.className=(c?c+" "+b:b).replace(/ {2,}/," ");return this}},prev:function(){this.flipTo(this.currentDom.previousElementSibling,"backward")},next:function(){this.flipTo(this.currentDom.nextElementSibling,"forward")},arrowLeft:document.querySelector(".arrow.left"),arrowRight:document.querySelector(".arrow.right"),flipTo:function(a,b){if(a==this.currentDom||!a)return a=this.currentDom,this.registerTremble(a,b);A.show();var c=this;"love-movie"!=a.id&&"love-movie"!=c.currentDom.id||z.pause();if("album"==this.currentDom.id){var d=this.currentDom.querySelector("div");d.className="fade-out";setTimeout(function(){d.className=""},500)}"album"==a.id&&(d=a.querySelector("div"),setTimeout(function(){d.className="fade-in"},1E3));var e,g;switch(b){case"forward":e="flip-0-m90";g="flip-90-0";break;default:e="flip-0-90",g="flip-m90-0"}var f=c.currentDom;c.addClass(f,e);setTimeout(function(){c.addClass(f,"rotateY-90").removeClass(f,e);c.addClass(a,g);setTimeout(function(){c.afterFlipped(a,b,g);L[a.dataset.init]instanceof Function&&(L[a.dataset.init](a),a.dataset.init=null)},c.timeout)},c.timeout);this.currentDom=a},afterFlipped:function(a,b,c){this.removeClass(a,"rotateY-90").removeClass(a,c);A.hide();this.registerArrow(a);this.registerTremble(a,b)},registerTremble:function(a,b){var c=a.className;a.className=c+" tremble "+("backward"==b?"anti":"")+"clockwise";A.show();setTimeout(function(){A.hide();a.className=c},500)},registerArrow:function(a){this.arrowRight.className=a.nextElementSibling?"arrow right":"arrow right disabled";this.arrowLeft.className=a.previousElementSibling?"arrow left":"arrow left disabled"}};var k=new w;I.prototype={downloadInterval:100,img:null,show:function(){switch(TERMINAL){case"pc":if(k.hasClass(this.album,"photo-in"))break;this.album.className+=" photo-in";break;case"mobile":var a=this.album.querySelector("img");"string"==typeof a&&(a=document.querySelector(a));a.src=a.dataset.src}},init:function(){switch(TERMINAL){case"pc":return this._initPc();case"mobile":return this._initMobile()}return this},_initMobile:function(){IS_WECHAT&&h(document.querySelector(".wrapper .album .start"),"click",function(){E.show();D.previewImage(function(){E.hide()})})},_initPc:function(){function a(){c.img.src=DATA.photoHost+"/"+b+".jpg"}var b=17,c=this;this.img=new Image;this.img.onload=function(){c.lis[b-1].querySelector("img").src=DATA.photoHost+"/"+b+".jpg";0<--b?setTimeout(a,c.downloadInterval):(this.onload=null,c.img=null)};a();for(b=0;b<c.imgCount;b++)c.lis[b].index=b,h(c.lis[b],"click",function(){var a=this;a.className="photo-out";setTimeout(function(){a.className="hide"},c.timeout);0==this.index&&setTimeout(function(){k.removeClass(c.album,"photo-in");for(var a=0;a<c.imgCount;a++)c.lis[a].className="";c.show()},c.timeout)});return this}};var J=new I,x={diff:window.diff,zeroFill:function(a){return 10>a?"0"+a:a},together:function(){var a,b=this,c=R.querySelectorAll(".value"),d=c[0],e=c[1],g=c[2],f=c[3];this.register(function(){a=(new Date-b.diff)/1E3-1405785600;d.innerText=b._days(a);e.innerText=b._hour(a);g.innerText=b._minute(a);f.innerText=b._second(a)})},story:function(){var a,b=this,c=document.querySelector("#timing-love-story").querySelectorAll(".value"),d=c[0],e=c[1],g=c[2],f=c[3],t=c[4],h=c[5];this.register(function(){a=(new Date-b.diff)/1E3-1030809600;d.innerText=b._years(a);e.innerText=b._month(a);g.innerText=b._day(a);f.innerText=b._hour(a);t.innerText=b._minute(a);h.innerText=b._second(a)})},marriage:function(){var a=DATA.marriage,b,c=this,d=document.querySelector("#timing-to-marriage").querySelectorAll(".value");if(d){var e=d[0],g=d[1],f=d[2],h=d[3];this.register(function(){b=Math.abs(a-(new Date-c.diff)/1E3);e.innerText=c._days(b);g.innerText=c._hour(b);f.innerText=c._minute(b);h.innerText=c._second(b)})}},_years:function(a){return parseInt(a/86400/365)},_days:function(a){return this.zeroFill(parseInt(a/86400))},_month:function(a){return this.zeroFill(parseInt(a/86400%365/30))},_day:function(a){return this.zeroFill(parseInt(a/86400%365%30))},_hour:function(a){return this.zeroFill(parseInt(a/3600%24))},_minute:function(a){return this.zeroFill(parseInt(a/60%60))},_second:function(a){return this.zeroFill(parseInt(a%60))},register:function(a){a();setInterval(a,1E3)}},w=function(){if(this.menu=document.querySelector("#menu"))this.touch=this.menu.querySelector("#touch-us"),this.items=this.menu.querySelector("#items"),this.bubbleContainer=this.menu.querySelector("#bubble")};w.prototype={init:function(){this.menu&&(h(u.touch,"click",function(){k.hasClass(u.menu,"kiss")?u.hide():u.show()}),this.bubble(),this.registerJs())},registerJs:function(){for(var a=this.items.children,b=a.length,c=document.querySelector(".wrapper"),d=this,e=0;e<b;e++)h(a[e],"click",function(){var a=c.querySelector("."+this.dataset.class);a&&(k.flipTo(a),d.hide())})},hide:function(){var a=this;a.menu.className+=" fade";setTimeout(function(){a.menu.className="";a.touch.className="touch-in"},500)},show:function(){k.hasClass(this.menu,"kiss")||("love-movie"==k.currentDom.id&&z.pause(),this.touch.className="",this.menu.className="kiss")},bubble:function(){for(var a=0;10>a;a++)this.bubbleContainer.appendChild(new Heart(document.createElement("canvas")))}};var u=new w,E={_:document.querySelector("#heartbeats"),init:function(){for(var a=0;3>a;a++)this._.appendChild(new Heart(document.createElement("canvas")))},show:function(){this._.className="beats";var a=this;setTimeout(function(){a.hide()},1E3)},hide:function(){this._.className=""}};E.init();var L={timeLine:function(a){r.style.height=l.width+"px";r.style.bottom=(l.height-l.width)/2+"px";r.className="plan-b fade-in";setTimeout(function(){r.parentNode.className="kiss";setTimeout(function(){r.parentNode.className+=" zoom-out";setTimeout(function(){document.querySelector("#time-anchors").style.display="block"},1E3)},600)},1E3)},loveStory:function(a){function b(a,b){var d;a.className+=" line-in";if(d=a.dataset.timingType)x[d]();b&&b.offsetTop>l.height&&c.scrollToElement(a,2E3)}var c=new IScroll("#love-story"),d=a.querySelectorAll(".line"),e=d.length,g=1;b(d[0]);var f=setInterval(function(){g<e?b(d[g],d[++g]):clearInterval(f)},3E3)},typeIn:function(a){var b;new IScroll("#love-story");for(var c=0,d=a.children[0].children,e=d.length;c<e;c++)a=(b=d[c].dataset.timingType)?x[b]:void 0,y.add(d[c],a);y.start()},albumShow:function(){J.show()},openMap:function(a){var b=new BMap.Map("map"),c=new BMap.Point(103.920752,30.606453);b.centerAndZoom(c,15);b.addOverlay(new BMap.Marker(c));if(IS_WECHAT){var d=a.querySelector("#open-map");h(d,"click",function(){d.className="active";setTimeout(function(){d.className="";D.openLocation()},50)})}},movie:function(a){q.src=q.dataset.src;h(z.startButton,"click",function(){z.play()})}}}();